@Service
public class FiltroServicio {

    private final ClienteServicioExterno clienteServicioExterno;

    public FiltroServicio(ClienteServicioExterno clienteServicioExterno) {
        this.clienteServicioExterno = clienteServicioExterno;
    }

    public Flux<RespuestaFiltrada> filtrarPorStatus(String status) {
        return clienteServicioExterno.obtenerDatos()
            .map(respuestaExterna -> {
                // Si hay errores, retornamos la respuesta tal cual
                if (respuestaExterna.getErrores() != null && !respuestaExterna.getErrores().isEmpty()) {
                    return new RespuestaFiltrada(Collections.emptyList(), "Errores encontrados", "400");
                }

                // Filtramos la lista de resultados por status
                List<StatusDto> filtrados = respuestaExterna.getResultados().stream()
                        .filter(dto -> status.equalsIgnoreCase(dto.getStatus()))
                        .collect(Collectors.toList());

                // Convertimos la lista de StatusDto a una lista de NuevoDto
                List<NuevoDto> nuevaLista = filtrados.stream()
                        .map(dto -> new NuevoDto(dto.getStatus(), "Descripci√≥n para el status " + dto.getStatus()))
                        .collect(Collectors.toList());

                // Creamos una nueva respuesta con la lista convertida y los atributos adicionales
                return new RespuestaFiltrada(nuevaLista, "Datos filtrados correctamente", "200");
            });
    }
}








public class RespuestaFiltrada {
    private List<NuevoDto> listaFiltrada; // Lista de objetos NuevoDto
    private String mensaje;
    private String codigo;

    // Constructor, getters y setters
    public RespuestaFiltrada(List<NuevoDto> listaFiltrada, String mensaje, String codigo) {
        this.listaFiltrada = listaFiltrada;
        this.mensaje = mensaje;
        this.codigo = codigo;
    }

    public List<NuevoDto> getListaFiltrada() {
        return listaFiltrada;
    }

    public void setListaFiltrada(List<NuevoDto> listaFiltrada) {
        this.listaFiltrada = listaFiltrada;
    }

    public String getMensaje() {
        return mensaje;
    }

    public void setMensaje(String mensaje) {
        this.mensaje = mensaje;
    }

    public String getCodigo() {
        return codigo;
    }

    public void setCodigo(String codigo) {
        this.codigo = codigo;
    }
}