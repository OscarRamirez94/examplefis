@WebFluxTest(CreditProductController.class)
class CreditProductControllerWebTest {

    @Autowired
    private WebTestClient webTestClient;

    @MockBean
    private CreditProductService service;

    @Test
    void shouldReturnOkWithCreditProducts() {
        CreditProduct creditProduct = new CreditProduct("001", "Tarjeta Oro");
        CreditProductResponse<CreditProduct> response = new CreditProductResponse<>();
        response.setData(List.of(creditProduct));

        when(service.getProducts()).thenReturn(Mono.just(response));

        webTestClient.get()
            .uri("/credit-products")
            .accept(MediaType.APPLICATION_JSON)
            .exchange()
            .expectStatus().isOk()
            .expectBody()
            .jsonPath("$.data[0].id").isEqualTo("001")
            .jsonPath("$.data[0].name").isEqualTo("Tarjeta Oro");
    }

    @Test
    void shouldReturnNoContentWhenNoProducts() {
        when(service.getProducts()).thenReturn(Mono.empty());

        webTestClient.get()
            .uri("/credit-products")
            .accept(MediaType.APPLICATION_JSON)
            .exchange()
            .expectStatus().isNoContent();
    }
}