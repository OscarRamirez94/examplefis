@ExtendWith(MockitoExtension.class)
class FiltroServicioTest {

    @Mock
    private ClienteServicioExterno clienteServicioExterno;

    private FiltroServicio filtroServicio;

    @BeforeEach
    void setUp() {
        filtroServicio = new FiltroServicio(clienteServicioExterno);
    }

    @Test
    void debeRetornarOkConDatosFiltrados() {
        StatusDto dto1 = new StatusDto("I", LocalDate.now());
        StatusDto dto2 = new StatusDto("A", LocalDate.now());
        RespuestaExterna respuesta = new RespuestaExterna(Collections.emptyList(), List.of(dto1, dto2));

        Mockito.when(clienteServicioExterno.obtenerDatos()).thenReturn(Mono.just(respuesta));

        filtroServicio.filtrarPorStatus("I")
            .as(StepVerifier::create)
            .expectNextMatches(response -> {
                RespuestaFiltrada body = response.getBody();
                return response.getStatusCode().is2xxSuccessful()
                        && body != null
                        && body.getListaFiltrada().size() == 1
                        && body.getListaFiltrada().get(0).getStatus().equals("I");
            })
            .verifyComplete();
    }

    @Test
    void debeRetornarNoContentCuandoNoHayResultados() {
        StatusDto dto = new StatusDto("A", LocalDate.now());
        RespuestaExterna respuesta = new RespuestaExterna(Collections.emptyList(), List.of(dto));

        Mockito.when(clienteServicioExterno.obtenerDatos()).thenReturn(Mono.just(respuesta));

        filtroServicio.filtrarPorStatus("I")
            .as(StepVerifier::create)
            .expectNext




public class RespuestaExterna {
    private List<String> errores;
    private List<StatusDto> resultados;

    // Constructor, getters, setters
}

public class StatusDto {
    private String status;
    private LocalDate fecha;

    // Constructor, getters, setters
}

public class NuevoDto {
    private String status;
    private String descripcion;

    // Constructor, getters, setters
}

public class RespuestaFiltrada {
    private List<NuevoDto> listaFiltrada;
    private String mensaje;
    private String codigo;

    // Constructor, getters, setters
}